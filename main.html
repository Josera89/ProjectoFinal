<html>
    <head>
        <title>---</title> 
        <meta charset="utf-8">
        <meta name="viewpoint" content="width=device-width,user-scalable=no">
    </head>
    
    <body>
        
        <div class="mapa">
            <img id="mapa-img">
        </div>
        
        <button onclick="actualizarPosicion()">Actulizar Posición</button>
        
        <input type="text" id="nombre" placeholder="Nombre Del Lugar">
        <input type="text" id="precio" placeholder="Precio De Lo Que Consumiste">
        <select id="categoria">
            <option disabled selected value>Categoría</option>
            <option value="retaurante">Restaurante</option>
            <option value="bar">Bar</option>
            <option value="antro">Antro</option>
        </select>
        <label>Calificación</label>
        <input type="range" min="1" max="5" value="5" id="calificacion" onchange="actualizarTexto()"/>
        <span id="valor"></span>
        
        <button onclick="guardar()">Guardar Lugar!</button>
                
    </body>
    
    <script>
                
        window.addEventListener('load', iniciar, true);
        
        function iniciar() {
            // Cargar texto inicial de slider 'calificacion'
            actualizarTexto();
            
            // Obtener la posicion actual
            navigator.geolocation.getCurrentPosition(actualizarPosicion);
        }
        
        function actualizarPosicion(posicion) {
            localStorage.setItem('long',posicion.coords.longitude);
            localStorage.setItem('lat', posicion.coords.latitude);   
            dibujarMapa();
        }
        
        function dibujarMapa() {
            mapa = document.getElementById('mapa-img');
            lat = localStorage.getItem('lat');
            long = localStorage.getItem('long');

            mapa.src = "http://maps.googleapis.com/maps/api/staticmap?center="+ lat + "," + long + 
                "&zoom=17&size=500x500&markers=color:red%7Clabel:YO!%7C" + lat + ',' + long;
        }
        
        // Actualiza el texto del slider 'calificacion'
        function actualizarTexto() {
            document.getElementById('valor').innerHTML = document.getElementById('calificacion').value;
        }
        
        function guardar() {
            var nombre = document.getElementById('nombre').value;
            var precio = document.getElementById('precio').value;
            var categoria = document.getElementById('categoria').value;
            var calificacion = document.getElementById('calificacion').value;
            
            if(localStorage.getItem('contador')) {
                contador = localStorage.getItem('contador')
            }else { contador = 1;}
            
            if(nombre != "" && precio != "" && categoria != "") {
                
                localStorage.setItem('nombre'+contador, nombre);
                localStorage.setItem('precio'+contador, precio);
                localStorage.setItem('categoria'+contador, categoria);
                localStorage.setItem('calificacion'+contador, calificacion);
                localStorage.setItem('lat'+contador, lat);
                localStorage.setItem('long'+contador, long);
                
                contador++;
                localStorage.setItem('contador', contador);
                
                // Limpiar campos
                document.getElementById('nombre').value = "";
                document.getElementById('precio').value = "";
                document.querySelector('option[selected]').selected = true;
                document.getElementById('calificacion').value = 5;
                actualizarTexto();
                
                alert("Has guardado un nuevo lugar!");
                
            }else { alert("Por favor, llena todos los campos!");}
            
        }

    </script>
    
</html>
